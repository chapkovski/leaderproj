{% extends "global/Page.html" %}
{% load otree %}

{% block title %}
    Questionnaire
{% endblock %}

{% block content %}

    <script src="{% static 'surveyjs/survey.core.min.js' %}"></script>

    <link href="{% static 'surveyjs/defaultV2.min.css' %}" type="text/css" rel="stylesheet">

    <!-- SurveyJS UI -->
    <script src="{% static 'surveyjs/survey-js-ui.min.js' %}"></script>

    <!-- SurveyJS Layered Themes -->
    <script src="{% static 'surveyjs/layered-dark-panelless.min.js' %}"></script>
    <script src="{% static 'surveyjs/layered-light-panelless.min.js' %}"></script>

    <!-- SurveyJS Bootstrap Integration -->
    <script src="{% static 'surveyjs/bootstrap-integration.min.js' %}"></script>

    <!-- Bootstrap and Popper -->
    <script src="{% static 'surveyjs/popper.min.js' %}"></script>
    <script src="{% static 'surveyjs/bootstrap.min.js' %}"></script>

    <!--lodash-->
    <script src="{% static 'surveyjs/lodash.min.js' %}"></script>
    <style>
        nav.navbar.navbar-light.bg-light.justify-content-between.fixed-top {
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-white: #fff;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --bs-primary: #0d6efd;
            --bs-secondary: #6c757d;
            --bs-success: #198754;
            --bs-info: #0dcaf0;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-light: #f8f9fa;
            --bs-dark: #212529;
            --bs-font-sans-serif: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --bs-font-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --bs-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));
            font-family: var(--bs-font-sans-serif);
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            padding-top: .5rem;
            padding-bottom: .5rem;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            z-index: 1030;
            justify-content: space-between !important;
            background-color: #f8f9fa !important;
        }

        .navbar-nav.flex-grow-1.mx-1 {
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-white: #fff;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --bs-primary: #0d6efd;
            --bs-secondary: #6c757d;
            --bs-success: #198754;
            --bs-info: #0dcaf0;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-light: #f8f9fa;
            --bs-dark: #212529;
            --bs-font-sans-serif: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji" !important;
            --bs-font-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace !important;
            --bs-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));
            font-family: var(--bs-font-sans-serif);
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            padding-left: 0;
            margin-bottom: 0;
            list-style: none;
            flex-grow: 1 !important;
            margin-right: .25rem !important;
            margin-left: .25rem !important;
        }

        div.progress {
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-white: #fff;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --bs-primary: #0d6efd;
            --bs-secondary: #6c757d;
            --bs-success: #198754;
            --bs-info: #0dcaf0;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-light: #f8f9fa;
            --bs-dark: #212529;
            --bs-font-sans-serif: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --bs-font-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --bs-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));
            font-family: var(--bs-font-sans-serif);
            font-weight: 400;
            line-height: 1.5;
            color: #212529;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            list-style: none;
            box-sizing: border-box;
            display: flex;
            overflow: hidden;
            font-size: .75rem;
            background-color: #e9ecef;
            border-radius: .25rem;
            height: 30px;
        }

        div.progress-bar {
            height: 100% !important;
            --bs-blue: #0d6efd;
            --bs-indigo: #6610f2;
            --bs-purple: #6f42c1;
            --bs-pink: #d63384;
            --bs-red: #dc3545;
            --bs-orange: #fd7e14;
            --bs-yellow: #ffc107;
            --bs-green: #198754;
            --bs-teal: #20c997;
            --bs-cyan: #0dcaf0;
            --bs-white: #fff;
            --bs-gray: #6c757d;
            --bs-gray-dark: #343a40;
            --bs-primary: #0d6efd;
            --bs-secondary: #6c757d;
            --bs-success: #198754;
            --bs-info: #0dcaf0;
            --bs-warning: #ffc107;
            --bs-danger: #dc3545;
            --bs-light: #f8f9fa;
            --bs-dark: #212529;
            --bs-font-sans-serif: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            --bs-font-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            --bs-gradient: linear-gradient(180deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0));
            font-family: var(--bs-font-sans-serif);
            font-weight: 400;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
            list-style: none;
            font-size: .75rem;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            background-color: #0d6efd;
            transition: width .6s ease;
            width: 12%;
        }

        .sd-table {
            border-collapse: collapse;
            width: 100%;
        }

        /* Ensure table container scrolls while header remains visible */
        .sd-table {
            border-collapse: collapse;
            width: 100%;
        }

        .sd-matrix__table {
            display: block; /* Make table behave like a block to enable scrolling */
            max-height: 400px; /* Adjust based on your needs */
            overflow-y: auto;
            overflow-x: auto;
        }

        .sd-matrix__table thead {
            position: sticky;
            top: 0;
            background: white; /* Prevents header from blending with the background */
            z-index: 10; /* Ensures the header is above the content */
        }

        .sd-matrix__table th {
            position: sticky;
            top: 0;
            background: white;
            z-index: 10;
            box-shadow: 0px 2px 2px rgba(0, 0, 0, 0.1); /* Adds subtle shadow for visibility */
        }
    </style>


    <div id="surveyContainer"></div>
    <script>
        // Survey JSON for NASA TLX ratings
        const surveyJSON = {
            "pages": [
                {
                    "name": "page1",
                    "elements": [
                        {
                            "type": "matrix",
                            "name": "bigFive",
                            "title": "I see myself as someone who…",
                            "isRequired": true,
                            "isAllRowRequired": true,
                            "columns": [
                                {
                                    "value": 1,
                                    "text": "Disagree strongly"
                                },
                                {
                                    "value": 2,
                                    "text": "Disagree a little"
                                },
                                {
                                    "value": 3,
                                    "text": "Neither agree nor disagree"
                                },
                                {
                                    "value": 4,
                                    "text": "Agree a little"
                                },
                                {
                                    "value": 5,
                                    "text": "Agree strongly"
                                }
                            ],
                            "rows": [
                                {
                                    "value": "reserved",
                                    "text": "…is reserved"
                                },
                                {
                                    "value": "trusting",
                                    "text": "…is generally trusting"
                                },
                                {
                                    "value": "lazy",
                                    "text": "…tends to be lazy"
                                },
                                {
                                    "value": "relaxed",
                                    "text": "…is relaxed, handles stress well"
                                },
                                {
                                    "value": "artisticInterests",
                                    "text": "…has few artistic interests"
                                },
                                {
                                    "value": "outgoing",
                                    "text": "…is outgoing, sociable"
                                },
                                {
                                    "value": "faultFinding",
                                    "text": "…tends to find fault with others"
                                },
                                {
                                    "value": "thorough",
                                    "text": "…does a thorough job"
                                },
                                {
                                    "value": "nervous",
                                    "text": "…gets nervous easily"
                                },
                                {
                                    "value": "imagination",
                                    "text": "…has an active imagination"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "page2",
                    "elements": [
                        {
                            "type": "matrix",
                            "name": "mindfulOrganizing",
                            "title": "Please rate from 1 to 7 how the below statements describe your experience in the team.",
                            "isRequired": true,
                            "isAllRowRequired": true,
                            "columns": [
                                {
                                    "value": 1,
                                    "text": "Not at all"
                                },
                                {
                                    "value": 2,
                                    "text": "To a very limited extent"
                                },
                                {
                                    "value": 3,
                                    "text": "To a limited extent"
                                },
                                {
                                    "value": 4,
                                    "text": "To a moderate extent"
                                },
                                {
                                    "value": 5,
                                    "text": "To a considerable extent"
                                },
                                {
                                    "value": 6,
                                    "text": "To a great extent"
                                },
                                {
                                    "value": 7,
                                    "text": "To a very great extent"
                                }
                            ],
                            "rows": [
                                {
                                    "value": "discussWhatToLookFor",
                                    "text": "When starting a new round, we discuss what to look for"
                                },
                                {
                                    "value": "identifyActivities",
                                    "text": "We spend time identifying activities we do not want to go wrong"
                                },
                                {
                                    "value": "discussAlternatives",
                                    "text": "We discuss alternatives as to how to go about our tasks"
                                },
                                {
                                    "value": "goodMapOfTalents",
                                    "text": "We have a good map of each other’s talents and skills"
                                },
                                {
                                    "value": "discussUniqueSkills",
                                    "text": "We discuss our unique skills with each other, so we know who on the unit has relevant specialized skills and knowledge"
                                },
                                {
                                    "value": "talkAboutMistakes",
                                    "text": "We talk about mistakes and ways to learn from them"
                                },
                                {
                                    "value": "discussErrorPrevention",
                                    "text": "When errors happen, we discuss how we could have prevented them"
                                },
                                {
                                    "value": "resolveProblemWithSkills",
                                    "text": "When attempting to resolve a problem, we take advantage of the unique skills of our colleagues"
                                },
                                {
                                    "value": "poolExpertiseInCrisis",
                                    "text": "When a crisis occurs, we rapidly pool our collective expertise to attempt to resolve it"
                                }
                            ]
                        }
                    ]
                }
            ],
            "showPrevButton": false,
            "completeText": "Next",
            "showCompletedPage": false,

        }

        const survey = new Survey.Model(surveyJSON);


        survey.applyTheme(SurveyTheme.LayeredLightPanelless);
        // Initialize the survey
        // Save results on completion
        survey.onComplete.add(function (result) {
            const surveyResults = JSON.stringify(result.data);
            console.log("Survey Results: ", surveyResults);

            // Submit the results via POST or other methods
            // Example: Sending to a hidden form field
            document.getElementById('surveyResults').value = surveyResults;
            $('#form').submit();
        });

        // Render the survey
        Survey.StylesManager.applyTheme("bootstrap");
        $("#surveyContainer").Survey({model: survey});
    </script>
    <!-- Hidden input to store results -->
    <input type="hidden" id="surveyResults" name="surveyResults" value="">
{% endblock %}